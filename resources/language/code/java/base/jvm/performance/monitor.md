# 性能监控

## todo

看完 JVM 之后再续前缘

单机版我觉得

JConsole

JStack

远程单机版

开源用 VisualVM Arthas

有钱可以用 JProfiler

分布式

Prometheus

Skywalking

[监控三套件EFK + Prometheus + SkyWalking, 经不经典我不管, 我就喜欢这一款_洪宏鸿的博客-CSDN博客](https://blog.csdn.net/HongZeng_CSDN/article/details/129968303)

[Java 性能诊断工具你好_洪宏鸿的博客-CSDN博客](https://blog.csdn.net/HongZeng_CSDN/article/details/129961396)

> Java 性能诊断工具, 从java自带的工具到单机图形化诊断工具再到分布式诊断工具

## Java自带的工具

Java自带了许多诊断工具，例如JConsole、JVisualVM、jmap、jstack、jcmd等。这些工具都是非常常用的工具，它们可以帮助开发人员诊断Java应用程序的性能问题。其中，JConsole和JVisualVM是图形化工具，可以用来监控JVM的运行状态、查看内存和CPU使用情况等；而jmap、jstack和jcmd是命令行工具，可以用来诊断内存泄漏、死锁等问题。

### JConsole

作用：JConsole是一个监视和管理Java应用程序的工具，可以监视JVM的运行状态、查看内存和CPU使用情况等。

优势：JConsole易于使用，可以通过图形化界面查看JVM的运行状态，快速了解应用程序的性能状况。

局限：JConsole只能监视本地JVM，无法监视远程JVM。

### JVisualVM

作用：JVisualVM是一个多合一的Java应用程序监视和管理工具，可以通过它监视和管理本地和远程JVM。

优势：JVisualVM可以监视和管理本地和远程JVM，支持多种插件，可以实现更丰富的功能。

局限：JVisualVM可能会影响应用程序的性能，需要谨慎使用。

### jmap

作用：jmap是一个命令行工具，可以用来查看Java堆的详细信息、生成堆转储文件等。

优势：jmap可以快速诊断内存泄漏问题，并生成堆转储文件以供分析。

局限：jmap需要停止应用程序才能生成堆转储文件，可能会影响应用程序的性能。

### jstack

作用：jstack是一个命令行工具，可以用来查看Java线程的堆栈信息。

优势：jstack可以用来诊断死锁问题，并定位线程卡死的位置。

局限：jstack只能查看当前线程的堆栈信息，无法查看历史堆栈信息。

### jcmd

作用：jcmd是一个命令行工具，可以用来诊断JVM，例如查看JVM的配置、线程信息、GC情况等。

优势：jcmd可以通过命令行对JVM进行诊断和管理。

局限：jcmd命令较多，需要熟悉其命令语法和使用方法。

## 单机图形化诊断工具

除了Java自带的工具之外，还有一些第三方的单机图形化诊断工具，例如YourKit、JProfiler、VisualVM等。这些工具提供了更为丰富的功能，例如内存泄漏检测、CPU分析、线程分析、堆转储等。它们可以帮助开发人员更快速地找到Java应用程序的性能瓶颈，并提供详细的分析报告和建议。

### YourKit

作用：YourKit是一个用于Java和.NET应用程序的性能和内存分析器。

优势：YourKit提供了一些高级功能，例如内存泄漏检测、线程分析、CPU分析等。

局限：YourKit是商业软件，需要购买许可证才能使用。

### JProfiler

#### 入门

[java - 性能诊断利器 JProfiler 快速入门和最佳实践 - 阿里云栖号 - SegmentFault 思否](https://segmentfault.com/a/1190000017795841)

作用：JProfiler是一个用于Java应用程序的性能分析器。

优势：JProfiler可以进行深入的性能分析，并提供了丰富的可视化报告和建议。

局限：JProfiler需要付费使用

### VisualVM

作用：VisualVM是一个多合一的Java应用程序监视和管理工具，可以通过它监视和管理本地和远程JVM。

优势：VisualVM集成了许多常用的Java诊断工具，如JConsole、jmap、jstack等，同时还支持多种插件。

局限：VisualVM在监视远程JVM时需要手动安装插件，安装和配置比较繁琐。

### Arthas

作用：一款基于Java Agent的分布式Java应用程序性能监测工具，主要用于实时诊断、代码追踪和性能分析等。

优势：

- 实时性能监测：可以实时监测Java应用程序的CPU、内存、线程、GC等指标，帮助开发人员深入了解应用程序的性能状况。

- 实时诊断：可以实时诊断Java应用程序的问题，并提供相应的解决方案，可以大大缩短问题定位和解决的时间。

- 代码追踪：可以实时追踪Java应用程序的方法调用、参数、返回值等信息，帮助开发人员深入了解应用程序的执行过程。

- 动态修改代码：可以在运行时动态地修改Java类的行为，帮助开发人员快速定位和解决问题。

- 低侵入性：使用Arthas不需要修改Java应用程序的代码，只需要在启动时添加Java Agent即可。

局限：

- 仅针对Java应用程序：Arthas只能监测Java应用程序的性能和瓶颈，对于其他类型的应用程序和系统无法监测。

- 对系统资源的消耗：Arthas需要消耗一定的系统资源，包括CPU和内存等，因此在大规模集群中使用时需要考虑系统资源的消耗。

- 局限于单机：Arthas是基于Java Agent的监测工具，只能监测单机的Java应用程序，无法监测分布式系统的性能和瓶颈。

## 分布式诊断工具

在分布式系统中，Java应用程序的性能问题通常更加复杂，因此需要使用专门的分布式诊断工具来解决问题。常见的分布式诊断工具包括Zipkin、SkyWalking、Pinpoint等。这些工具可以跟踪分布式应用程序的请求链路，帮助开发人员了解请求在系统中的流转情况，并分析各个节点的性能瓶颈。同时，这些工具也提供了可视化的界面，方便开发人员查看分布式应用程序的性能问题。

### Zipkin

作用：Zipkin是一个分布式跟踪系统，可以追踪分布式应用程序的请求链路，并帮助开发人员定位性能问题。

优势：Zipkin可以追踪跨越多个系统的请求，帮助开发人员了解请求在系统中的流转情况，并分析各个节点的性能瓶颈。

局限：Zipkin需要在系统中部署服务端和客户端，部署和配置比较繁琐。

### Prometheus

作用：一款分布式的时间序列数据监测工具，主要用于监测系统级别的指标，如CPU、内存、网络等，而不是针对具体的Java应用程序。

优势：

- 分布式性能监测：可以监测整个分布式系统的性能和瓶颈，帮助开发人员深入了解整个系统的状态和性能。

- 高度可扩展：Prometheus具有高度可扩展性，可以轻松添加新的监测指标和数据源，并支持水平扩展。

- 强大的查询和分析功能：Prometheus提供了强大的查询语言和可视化工具，可以对监测数据进行分析和展示，帮助开发人员了解整个系统的状态和性能，发现性能瓶颈和问题。

- 具有告警功能：Prometheus支持设置告警规则，一旦监测数据达到预设的阈值，可以及时发出告警信息，帮助开发人员快速定位问题。

局限：

- 对监测指标有限制：Prometheus监测的指标必须是数值型数据，而且必须是可导出的，因此无法监测一些非数值型的数据。

- 不支持完整的分布式跟踪：Prometheus可以通过客户端库监测分布式系统的指标，但并不支持完整的分布式跟踪，如分布式事务跟踪等。

- 存储和查询的性能问题：随着监测数据的增加，Prometheus的存储和查询性能会受到影响，需要对存储和查询进行优化和扩展。

### SkyWalking

作用：SkyWalking是一个分布式的应用程序性能监测系统，可以通过跟踪和监测分布式应用程序的请求链路，帮助开发人员了解系统的性能瓶颈。

优势：SkyWalking支持多种语言，能够跟踪分布式应用程序的请求链路，并提供详细的分析报告和建议。

局限：SkyWalking需要在系统中部署服务端和客户端，部署和配置比较繁琐。

### Pinpoint

作用：Pinpoint是一个分布式应用程序性能监测系统，可以跟踪分布式应用程序的请求链路，帮助开发人员定位性能问题。

优势：Pinpoint支持多种语言，提供了丰富的功能，包括方法级别的性能监测、线程分析、内存泄漏检测等。

局限：Pinpoint需要在系统中部署服务端和客户端，部署和配置比较繁琐。同时，Pinpoint的日志会占用较多磁盘空间，需要注意清理日志文件。

综上所述，Java性能诊断工具的选择取决于应用程序的类型和性能问题的类型。对于小型应用程序，Java自带的工具已经足够；对于大型应用程序和分布式系统，第三方工具和分布式诊断工具则更为适合。

### EFK/ELK

再说吧





[[译] 可靠地运维一个大型分布式系统：我的学习实践 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903917562626055)
