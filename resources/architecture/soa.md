# soa

https://www.bilibili.com/video/BV1nq4y1i7me/?spm_id_from=333.337.search-card.all.click&vd_source=eabc2c22ae7849c2c4f31815da49f209

核心就是:

1. 将大单件拆分成小服务, 实现服务的重用 -> 总线
2. 将各种服务进行组合, 满足业务需求 -> 编排

SOA架构是一种面向服务的架构，主要由服务、服务注册表、服务总线和服务编排器等组成。

下面是一个简单的SOA架构图示，用于说明SOA架构的基本组件和交互方式：

```lua
+-----------------------+                           +-----------------------+
|       Service 1        |                           |       Service 2        |
|    +---------------+  |                           |   +---------------+   |
|    |    Interface 1|  |                           |   |    Interface 2|   |
|    +---------------+  |                           |   +---------------+   |
|    |  Implementation 1| <--- Service Bus ---->    |   |  Implementation 2|   |
|    +---------------+  |                           |   +---------------+   |
+-----------------------+                           +-----------------------+
                   |                                           |
                   |                                           |
                   |                                           |
                   v                                           v
+-----------------------+                           +-----------------------+
|  Service Registry     |                           |  Service Orchestrator  |
+-----------------------+                           +-----------------------+
```

在这个图示中，有两个服务（Service 1和Service 2），每个服务都有自己的接口和实现。服务之间通过Service Bus进行通信，Service Bus是一个中间件组件，用于协调和管理服务之间的消息传递。服务的接口和实现都注册在Service Registry中，以便其他服务可以访问它们。服务编排器（Service Orchestrator）则用于协调和管理服务之间的业务流程，将不同的服务组合成一个完整的业务流程。服务编排器可以基于不同的规则和条件来选择和组合服务。

SOA架构的核心思想是将系统拆分为一组相互协作的服务，每个服务都具有明确定义的接口和独立的实现。通过使用Service Bus、Service Registry和Service Orchestrator等中间件组件，服务可以相互协作并进行集成。这种方式可以提高系统的可维护性、可扩展性和可重用性，同时还可以支持分布式部署和跨组织边界的集成。

### 电商soa架构

假设我们有一个电商网站，它使用SOA架构来实现各种功能。以下是一个简单的SOA架构示例，用于说明SOA架构的实际应用：

1. 订单服务（Order Service）：这个服务提供了一组用于创建、查询和取消订单的操作。订单服务的接口包括以下几个方法：
- CreateOrder（创建订单）：创建一个新的订单，并返回订单号。
- GetOrder（查询订单）：根据订单号查询订单信息，并返回订单详情。
- CancelOrder（取消订单）：取消一个已经存在的订单，并返回取消结果。

订单服务的实现包括一个数据库，用于存储订单信息，并且还包括一个Web API，用于提供服务接口。

2. 库存服务（Inventory Service）：这个服务提供了一组用于查询和更新商品库存的操作。库存服务的接口包括以下几个方法：
- GetStock（查询库存）：查询商品的库存数量，并返回库存信息。
- UpdateStock（更新库存）：更新商品的库存数量，并返回更新结果。

库存服务的实现包括一个数据库，用于存储商品库存信息，并且还包括一个Web API，用于提供服务接口。

3. 支付服务（Payment Service）：这个服务提供了一组用于处理支付请求和返回支付结果的操作。支付服务的接口包括以下几个方法：
- Pay（支付）：根据订单号和支付金额进行支付，并返回支付结果。
- Refund（退款）：根据订单号和退款金额进行退款，并返回退款结果。

支付服务的实现包括一个支付网关，用于处理支付请求和返回支付结果，并且还包括一个Web API，用于提供服务接口。

4. 服务总线（Service Bus）：这个组件用于协调和管理各个服务之间的消息传递。当一个服务需要调用另一个服务时，它会将请求消息发送到服务总线，服务总线会将消息路由到目标服务，并将响应消息返回给源服务。

5. 服务注册表（Service Registry）：这个组件用于注册和查找服务的接口和实现。每个服务都将自己的接口和实现注册到服务注册表中，并且其他服务可以通过服务注册表来查找和访问它们。

6. 服务编排器（Service Orchestrator）：这个组件用于协调和管理各个服务之间的业务流程。例如，在电商网站中，订单服务可能需要调用库存服务和支付服务来完成订单处理流程。服务编排器可以基于不同的规则和条件来选择和组合服务，以便完成完整的业务流程。

总之，SOA架构可以将系统拆分为一组相互协作的服务，每个服务都具有明确定义的接口和独立的实现。在电商网站的例子中，订单服务、库存服务和支付

#### 服务编排器

服务编排器 是怎么实现订单服务调用库存服务和支付服务来完成订单处理流程的

服务编排器是SOA架构中的一个重要组件，它用于协调和管理各个服务之间的业务流程。在电商网站的例子中，服务编排器可以使用以下步骤来实现订单服务调用库存服务和支付服务来完成订单处理流程：

1. 接收订单请求：当一个用户提交订单请求时，订单服务会将请求消息发送到服务总线，并且通知服务编排器。

2. 查询库存：服务编排器收到订单请求后，会调用库存服务的GetStock方法，查询商品库存信息。如果库存不足，服务编排器将返回一个错误消息，并且订单处理流程终止。

3. 支付订单：如果库存充足，服务编排器会调用支付服务的Pay方法，根据订单号和支付金额进行支付处理。如果支付成功，服务编排器将继续订单处理流程。如果支付失败，服务编排器将返回一个错误消息，并且订单处理流程终止。

4. 创建订单：如果库存充足且支付成功，服务编排器会调用订单服务的CreateOrder方法，创建一个新的订单，并返回订单号。订单服务会将订单信息保存到数据库中，并且通知服务编排器。

5. 返回响应消息：订单服务收到服务编排器的请求后，会将订单号封装到响应消息中，返回给服务编排器。服务编排器将响应消息发送回给用户，并结束订单处理流程。

在上述流程中，服务编排器充当了一个协调和管理各个服务之间业务流程的角色。它根据不同的规则和条件来选择和组合服务，以便完成完整的业务流程。这种方式可以提高系统的可维护性、可扩展性和可重用性，并且可以支持分布式部署和跨组织边界的集成。